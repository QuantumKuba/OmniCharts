<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>OmniCharts Vercel API Test</title>
  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      max-width: 800px;
      margin: 0 auto;
      padding: 20px;
      line-height: 1.6;
    }
    h1 { color: #333; }
    button {
      background: #0070f3;
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: 4px;
      cursor: pointer;
      margin-right: 8px;
      margin-bottom: 8px;
    }
    pre {
      background: #f1f1f1;
      padding: 16px;
      border-radius: 4px;
      overflow-x: auto;
    }
    .test-area {
      margin-bottom: 30px;
      border: 1px solid #eaeaea;
      padding: 16px;
      border-radius: 8px;
    }
    .result {
      margin-top: 16px;
      min-height: 100px;
    }
    .error {
      color: #d32f2f;
      background: #ffebee;
      padding: 12px;
      border-radius: 4px;
    }
    .success {
      color: #388e3c;
      background: #e8f5e9;
      padding: 12px;
      border-radius: 4px;
    }
  </style>
</head>
<body>
  <h1>OmniCharts Vercel API Test</h1>
  <p>This standalone page tests if the Vercel API endpoints are working correctly.</p>
  
  <div class="test-area">
    <h2>1. API Status</h2>
    <p>Tests if the API base endpoint is accessible</p>
    <button onclick="testApiStatus()">Test API Status</button>
    <div class="result" id="statusResult"></div>
  </div>
  
  <div class="test-area">
    <h2>2. Klines Endpoint</h2>
    <p>Tests the Binance klines data proxy</p>
    <div>
      <label for="symbol">Symbol:</label>
      <input id="symbol" value="BTCUSDT">
      <label for="interval">Interval:</label>
      <select id="interval">
        <option value="1m">1 minute</option>
        <option value="5m" selected>5 minutes</option>
        <option value="15m">15 minutes</option>
        <option value="1h">1 hour</option>
      </select>
      <label for="limit">Limit:</label>
      <input type="number" id="limit" value="5" min="1" max="1000">
    </div>
    <button onclick="testKlines()">Test Klines</button>
    <div class="result" id="klinesResult"></div>
  </div>
  
  <div class="test-area">
    <h2>3. General Proxy</h2>
    <p>Tests the general Binance API proxy</p>
    <button onclick="testProxy('exchangeInfo')">Test Exchange Info</button>
    <button onclick="testProxy('ticker/price?symbol=BTCUSDT')">Test BTC Price</button>
    <div class="result" id="proxyResult"></div>
  </div>

  <script>
    // Format JSON data for display
    function formatJson(data) {
      return JSON.stringify(data, null, 2);
    }
    
    // Display results
    function showResult(elementId, data, isError = false) {
      const element = document.getElementById(elementId);
      if (isError) {
        element.innerHTML = `<div class="error">Error: ${data}</div>`;
      } else {
        element.innerHTML = `<div class="success">Success!</div><pre>${formatJson(data)}</pre>`;
      }
    }
    
    // Test API status endpoint
    async function testApiStatus() {
      const element = document.getElementById('statusResult');
      element.innerHTML = '<p>Loading...</p>';
      
      try {
        const response = await fetch('/api');
        const data = await response.json();
        showResult('statusResult', data);
      } catch (error) {
        showResult('statusResult', error.message, true);
      }
    }
    
    // Test klines endpoint
    async function testKlines() {
      const element = document.getElementById('klinesResult');
      element.innerHTML = '<p>Loading...</p>';
      
      const symbol = document.getElementById('symbol').value || 'BTCUSDT';
      const interval = document.getElementById('interval').value || '5m';
      const limit = document.getElementById('limit').value || 5;
      
      try {
        const response = await fetch(`/api/v3/klines?symbol=${symbol}&interval=${interval}&limit=${limit}`);
        const data = await response.json();
        
        if (data.error) {
          showResult('klinesResult', data.error, true);
        } else {
          showResult('klinesResult', data);
        }
      } catch (error) {
        showResult('klinesResult', error.message, true);
      }
    }
    
    // Test proxy endpoint
    async function testProxy(endpoint) {
      const element = document.getElementById('proxyResult');
      element.innerHTML = '<p>Loading...</p>';
      
      try {
        const response = await fetch(`/api/v3/proxy?url=${encodeURIComponent(endpoint)}`);
        const data = await response.json();
        
        if (data.error) {
          showResult('proxyResult', data.error, true);
        } else {
          showResult('proxyResult', data);
        }
      } catch (error) {
        showResult('proxyResult', error.message, true);
      }
    }
  </script>
</body>
</html>